// Testing
// Utilizing dynamic properties like this is deprecated. We'll need to change this later.
task test(dependsOn:["jasmine"]){}

task prepForJUnit () {
	doLast {
		File outputDir = file("../target/junit")
		outputDir.mkdirs()
	}
}

task createJasmineRunner(type: Exec, description: "Build ci-testrunner.html") {
	commandLine = ["python", "../tools/jasmine/generate_test_runner.py", "./", "../tools/jasmine/ci-testrunner.html", "../tools/jasmine/spec-runner_TEMPLATE.html"]
}

task jasmine(type: Exec, dependsOn:[":target", "prepForJUnit", "createJasmineRunner"], description: "Runs Jasmine through RhinoJS"){
	os = System.getProperty("os.name").toLowerCase();
	phantomjs = "phantomjs"
	
	if (os.contains("windows")) {
		phantomjs = "../tools/phantomjs/win/" + phantomjs + ".exe"
	} else if (os.contains("mac os")) {
		phantomjs = "../tools/phantomjs/mac/" + phantomjs
	} else {
		phantomjs = "../tools/phantomjs/linux/bin/" + phantomjs 
	}
	
	phantomjs = file(phantomjs).absolutePath

	commandLine = [phantomjs, "../tools/phantomjs/run_jasmine_test.coffee", "../tools/jasmine/ci-testrunner.html"]
}

/*
task jsHint(type: Exec, dependsOn: ":clean", description: "Runs JSLint over source") {
	commandLine = ["python", "../tools/jshint/jshint.py"]
}*/